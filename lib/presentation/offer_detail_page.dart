import 'package:flutter/material.dart';import 'package:marketplace/main.dart';import 'package:marketplace/model/offer.dart';import 'package:marketplace/presentation/alert.dart';import 'package:marketplace/presentation/offer_detail/widget.dart';class OfferDetailPage extends StatefulWidget {  final Offer offer;  const OfferDetailPage({Key key, this.offer}) : super(key: key);  @override  State<StatefulWidget> createState() => _OfferDetailPageState();}class _OfferDetailPageState extends State<OfferDetailPage> {  @override  void initState() {    super.initState();    offersBloc.purchaseStream.listen(      (onData) {        if (onData != null) {          if (onData.purchase.success) {            purchaseAlert(context, "Awesome!", "You purchased your proiduct",                () => Navigator.of(context).pop());          } else {            purchaseAlert(context, "Oh no!", onData.purchase.errorMessage,                () => Navigator.of(context).pop());          }        }      },    );  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(widget.offer.product.name),      ),      body: Container(        color: Colors.teal,        child: Column(          crossAxisAlignment: CrossAxisAlignment.center,          children: <Widget>[            Expanded(child: buildOfferDetail(context, widget.offer)),            StreamBuilder(              stream: offersBloc.purchaseStream,              builder: (context, snapshot) {                return Container(                  margin: EdgeInsets.all(64),                  child: RaisedButton(                    onPressed: () => offersBloc.purchaseOffer(widget.offer.id),                    child: snapshot.hasData && snapshot.data.purchasing                        ? CircularProgressIndicator()                        : Text("Purchase"),                  ),                );              },            ),          ],        ),      ),    );  }}