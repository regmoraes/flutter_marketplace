import 'package:flutter/material.dart';import 'package:marketplace/model/offer.dart';import 'package:marketplace/presentation/app_bloc.dart';import 'package:marketplace/presentation/offer_detail/alert.dart';import 'package:marketplace/presentation/offer_detail/offer_detail.dart';import 'package:marketplace/presentation/offer_detail/purchase_button.dart';import 'package:marketplace/presentation/states.dart';import 'package:provider/provider.dart';class OfferDetailPage extends StatefulWidget {  final Offer offer;  const OfferDetailPage({Key key, this.offer}) : super(key: key);  @override  State<StatefulWidget> createState() => _OfferDetailPageState();}class _OfferDetailPageState extends State<OfferDetailPage> {  AppBloc appBloc;  @override  void initState() {    super.initState();    appBloc = Provider.of<AppBloc>(context, listen: false);    appBloc.purchaseStream.listen(      (onData) {        if (onData != null) {          if (onData.purchase.success) {            purchaseAlert(context, "Awesome!", "You purchased your product",                () => Navigator.of(context).pop());          } else {            purchaseAlert(context, "Oh no!", onData.purchase.errorMessage,                () => Navigator.of(context).pop());          }        }      },    );  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(widget.offer.product.name),      ),      body: Container(        child: Column(          crossAxisAlignment: CrossAxisAlignment.center,          children: <Widget>[            Expanded(child: OfferDetail(widget.offer)),            StreamBuilder(              stream: appBloc.purchaseStream,              initialData: PurchaseState(),              builder: (context, AsyncSnapshot<PurchaseState> snapshot) {                if (snapshot.hasData)                  return PurchaseButton(snapshot.data,                          () => appBloc.purchaseOffer(widget.offer.id));                else                  return Container();              },            )          ],        ),      ),    );  }}